(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[754],{85791:(e,s,t)=>{Promise.resolve().then(t.bind(t,21372))},21372:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>S});var a=t(95155),r=t(547),l=t(63259),i=t(35007),n=t(285),d=t(25488),c=t(58581),o=t(394),m=t(15255),x=t(12800),u=t(66963),h=t(27112),f=t(23021),p=t(22175),j=t(90457),v=t(67732),g=t(86354),w=t(94973),N=t(16161),y=t(12115),b=t(76964),_=t(7793),A=t(54567),C=t(33719),R=t(50745);let k=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#6366f1"],Z=e=>{let{active:s,payload:t}=e;if(s&&t&&t.length){let e=t[0].payload;return(0,a.jsxs)("div",{className:"bg-white p-2 shadow-lg rounded-lg border",children:[(0,a.jsx)("p",{className:"font-medium",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.count," items (",e.percentage.toFixed(1),"%)"]})]})}return null};function S(){var e,s,t;let[S,D]=(0,y.useState)("7days"),L=(0,l.U)(),{data:E,isLoading:I,error:W}=(0,r.I)({queryKey:["analytics-overview",S],queryFn:async()=>{let e=new Date,s="7days"===S?7:"30days"===S?30:90,t=(0,b.o)((0,_.e)(e,s)),a=(0,A.D)(e),r=(0,b.o)((0,_.e)(t,s)),[l,i,n,d]=await Promise.all([L.from("menu_items").select("id, name, is_available, category_id"),L.from("categories").select("id, name"),L.from("menu_item_views").select("menu_item_id, viewed_at").gte("viewed_at",t.toISOString()).lte("viewed_at",a.toISOString()),L.from("menu_item_views").select("menu_item_id, viewed_at").gte("viewed_at",r.toISOString()).lt("viewed_at",t.toISOString())]);if(l.error)throw l.error;if(i.error)throw i.error;if(n.error)throw n.error;if(d.error)throw d.error;let c=l.data,o=i.data,m=n.data,x=d.data,u=c.length,h=c.filter(e=>e.is_available).length,f=m.length,p=x.length,j=c.map(e=>({name:e.name,views:m.filter(s=>s.menu_item_id===e.id).length})).sort((e,s)=>s.views-e.views).slice(0,5),v=new Map(o.map(e=>[e.id,e.name])),g=Array.from(c.reduce((e,s)=>{if(!s.category_id)return e;let t=e.get(s.category_id)||0;return e.set(s.category_id,t+1),e},new Map).entries()).map(e=>{let[s,t]=e;return{name:v.get(s)||"Uncategorized",count:t}}),w=g.reduce((e,s)=>e+s.count,0),N=g.map(e=>({...e,percentage:e.count/w*100})),y=[];for(let t=0;t<s;t++){let a=(0,_.e)(e,s-1-t),r=(0,b.o)(a),l=(0,A.D)(a),i=m.filter(e=>{let s=new Date(e.viewed_at);return s>=r&&s<=l}).length,n=x.filter(e=>{let t=new Date(e.viewed_at);return t>=(0,b.o)((0,_.e)(a,s))&&t<=(0,A.D)((0,_.e)(a,s))}).length;y.push({date:(0,C.GP)(a,"MMM d"),views:i,previousViews:n})}return{totalViews:f,totalItems:u,activeItems:h,popularItems:j,categoryDistribution:N,timeViews:y,viewsChange:0===p?100:(f-p)/p*100}}});return W?(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)(i.Zp,{className:"bg-destructive/10",children:[(0,a.jsx)(i.aR,{children:(0,a.jsx)(i.ZB,{className:"text-destructive",children:"Error Loading Analytics"})}),(0,a.jsx)(i.Wu,{children:(0,a.jsx)("p",{children:"Failed to load analytics data. Please try again later."})})]})}):(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Analytics Overview"}),(0,a.jsxs)(R.l6,{value:S,onValueChange:e=>D(e),children:[(0,a.jsx)(R.bq,{className:"w-[180px]",children:(0,a.jsx)(R.yv,{placeholder:"Select time period"})}),(0,a.jsxs)(R.gC,{children:[(0,a.jsx)(R.eb,{value:"7days",children:"Last 7 days"}),(0,a.jsx)(R.eb,{value:"30days",children:"Last 30 days"}),(0,a.jsx)(R.eb,{value:"90days",children:"Last 90 days"})]})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsxs)(i.Zp,{children:[(0,a.jsxs)(i.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i.ZB,{className:"text-sm font-medium",children:"Total Views"}),(0,a.jsx)(n.F.chart,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(i.Wu,{children:I?(0,a.jsx)(d.E,{className:"h-7 w-20"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:null==E?void 0:E.totalViews.toLocaleString()}),(0,a.jsxs)("p",{className:"text-xs ".concat((null!==(e=null==E?void 0:E.viewsChange)&&void 0!==e?e:0)>=0?"text-green-500":"text-red-500"),children:[(null!==(s=null==E?void 0:E.viewsChange)&&void 0!==s?s:0)>=0?"↑":"↓"," ",Math.abs(null!==(t=null==E?void 0:E.viewsChange)&&void 0!==t?t:0).toFixed(1),"%",(0,a.jsx)("span",{className:"text-muted-foreground",children:" vs previous period"})]})]})})]}),(0,a.jsxs)(i.Zp,{children:[(0,a.jsxs)(i.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i.ZB,{className:"text-sm font-medium",children:"Menu Items"}),(0,a.jsx)(n.F.list,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(i.Wu,{children:I?(0,a.jsx)(d.E,{className:"h-7 w-20"}):(0,a.jsx)("div",{className:"text-2xl font-bold",children:null==E?void 0:E.totalItems.toLocaleString()})})]}),(0,a.jsxs)(i.Zp,{children:[(0,a.jsxs)(i.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i.ZB,{className:"text-sm font-medium",children:"Active Items"}),(0,a.jsx)(n.F.check,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(i.Wu,{children:I?(0,a.jsx)(d.E,{className:"h-7 w-20"}):(0,a.jsx)("div",{className:"text-2xl font-bold",children:null==E?void 0:E.activeItems.toLocaleString()})})]}),(0,a.jsxs)(i.Zp,{children:[(0,a.jsxs)(i.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i.ZB,{className:"text-sm font-medium",children:"Categories"}),(0,a.jsx)(n.F.list,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(i.Wu,{children:I?(0,a.jsx)(d.E,{className:"h-7 w-20"}):(0,a.jsx)("div",{className:"text-2xl font-bold",children:null==E?void 0:E.categoryDistribution.length.toLocaleString()})})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)(i.Zp,{className:"col-span-2",children:[(0,a.jsx)(i.aR,{children:(0,a.jsx)(i.ZB,{children:"Popular Items"})}),(0,a.jsx)(i.Wu,{children:I?(0,a.jsx)("div",{className:"h-[300px] flex items-center justify-center",children:(0,a.jsx)(d.E,{className:"h-[250px] w-full"})}):(0,a.jsx)("div",{className:"h-[300px]",children:(0,a.jsx)(c.u,{width:"100%",height:"100%",children:(0,a.jsxs)(o.E,{data:null==E?void 0:E.popularItems,margin:{top:5,right:30,left:20,bottom:5},children:[(0,a.jsx)(m.d,{strokeDasharray:"3 3"}),(0,a.jsx)(x.W,{dataKey:"name",tick:{fontSize:12},interval:0,angle:-45,textAnchor:"end",height:70}),(0,a.jsx)(u.h,{tick:{fontSize:12},label:{value:"Views",angle:-90,position:"insideLeft"}}),(0,a.jsx)(h.m,{}),(0,a.jsx)(f.y,{dataKey:"views",fill:"#3b82f6",radius:[4,4,0,0]})]})})})})]}),(0,a.jsxs)(i.Zp,{children:[(0,a.jsx)(i.aR,{children:(0,a.jsx)(i.ZB,{children:"Popular Items List"})}),(0,a.jsx)(i.Wu,{children:I?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(d.E,{className:"h-4 w-full"},s))}):(0,a.jsx)("div",{className:"space-y-2",children:null==E?void 0:E.popularItems.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"truncate",children:e.name}),(0,a.jsxs)("span",{className:"font-medium",children:[e.views.toLocaleString()," views"]})]},s))})})]}),(0,a.jsxs)(i.Zp,{className:"col-span-2",children:[(0,a.jsx)(i.aR,{children:(0,a.jsx)(i.ZB,{children:"Category Distribution"})}),(0,a.jsx)(i.Wu,{children:(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsx)("div",{children:I?(0,a.jsx)("div",{className:"h-[300px] flex items-center justify-center",children:(0,a.jsx)(d.E,{className:"h-[250px] w-full"})}):(0,a.jsx)("div",{className:"h-[300px]",children:(0,a.jsx)(c.u,{width:"100%",height:"100%",children:(0,a.jsxs)(p.r,{children:[(0,a.jsx)(j.F,{data:null==E?void 0:E.categoryDistribution,dataKey:"count",nameKey:"name",cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:2,children:null==E?void 0:E.categoryDistribution.map((e,s)=>(0,a.jsx)(v.f,{fill:k[s%k.length]},"cell-".concat(s)))}),(0,a.jsx)(h.m,{content:(0,a.jsx)(Z,{})}),(0,a.jsx)(g.s,{})]})})})}),(0,a.jsx)("div",{className:"space-y-2",children:I?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(d.E,{className:"h-4 w-full"},s))}):(0,a.jsx)("div",{className:"space-y-2",children:null==E?void 0:E.categoryDistribution.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:k[s%k.length]}}),(0,a.jsx)("span",{className:"truncate",children:e.name})]}),(0,a.jsxs)("div",{className:"flex gap-2 text-muted-foreground",children:[(0,a.jsxs)("span",{children:[e.count," items"]}),(0,a.jsxs)("span",{children:["(",e.percentage.toFixed(1),"%)"]})]})]},s))})})]})})]})]}),(0,a.jsxs)(i.Zp,{className:"col-span-2",children:[(0,a.jsx)(i.aR,{children:(0,a.jsx)(i.ZB,{children:"Views Over Time"})}),(0,a.jsx)(i.Wu,{children:I?(0,a.jsx)("div",{className:"h-[300px] flex items-center justify-center",children:(0,a.jsx)(d.E,{className:"h-[250px] w-full"})}):(0,a.jsx)("div",{className:"h-[300px]",children:(0,a.jsx)(c.u,{width:"100%",height:"100%",children:(0,a.jsxs)(w.b,{data:null==E?void 0:E.timeViews,margin:{top:5,right:30,left:20,bottom:5},children:[(0,a.jsx)(m.d,{strokeDasharray:"3 3"}),(0,a.jsx)(x.W,{dataKey:"date",tick:{fontSize:12}}),(0,a.jsx)(u.h,{tick:{fontSize:12},label:{value:"Views",angle:-90,position:"insideLeft"}}),(0,a.jsx)(h.m,{}),(0,a.jsx)(N.N,{type:"monotone",dataKey:"views",stroke:"#3b82f6",strokeWidth:2,dot:!1,name:"Current Period"}),(0,a.jsx)(N.N,{type:"monotone",dataKey:"previousViews",stroke:"#94a3b8",strokeWidth:2,strokeDasharray:"5 5",dot:!1,name:"Previous Period"})]})})})})]})]})}},35007:(e,s,t)=>{"use strict";t.d(s,{BT:()=>c,Wu:()=>o,ZB:()=>d,Zp:()=>i,aR:()=>n,wL:()=>m});var a=t(95155),r=t(12115),l=t(29602);let i=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("rounded-xl border bg-card text-card-foreground shadow",t),...r})});i.displayName="Card";let n=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",t),...r})});n.displayName="CardHeader";let d=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h3",{ref:s,className:(0,l.cn)("font-semibold leading-none tracking-tight",t),...r})});d.displayName="CardTitle";let c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("p",{ref:s,className:(0,l.cn)("text-sm text-muted-foreground",t),...r})});c.displayName="CardDescription";let o=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("p-6 pt-0",t),...r})});o.displayName="CardContent";let m=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("flex items-center p-6 pt-0",t),...r})});m.displayName="CardFooter"},285:(e,s,t)=>{"use strict";t.d(s,{F:()=>y});var a=t(88218),r=t(40767),l=t(70001),i=t(93518),n=t(46967),d=t(86710),c=t(22104),o=t(87725),m=t(98867),x=t(15800),u=t(33473),h=t(28527),f=t(68236),p=t(77568),j=t(60872),v=t(27530),g=t(28701),w=t(19993),N=t(23920);let y={logo:a.A,close:r.A,spinner:l.A,chevronLeft:i.A,chevronRight:n.A,menu:d.A,moon:c.A,sun:o.A,check:m.A,chevronsUpDown:x.A,add:u.A,chart:h.A,settings:f.A,qr:p.A,edit:j.A,grip:v.A,list:g.A,trash:w.A,copy:N.A}},50745:(e,s,t)=>{"use strict";t.d(s,{bq:()=>x,eb:()=>p,gC:()=>f,l6:()=>o,yv:()=>m});var a=t(95155),r=t(12115),l=t(63409),i=t(51719),n=t(91902),d=t(98867),c=t(29602);let o=l.bL;l.YJ;let m=l.WT,x=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)(l.l9,{ref:s,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[r,(0,a.jsx)(l.In,{asChild:!0,children:(0,a.jsx)(i.A,{className:"h-4 w-4 opacity-50"})})]})});x.displayName=l.l9.displayName;let u=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.PP,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(n.A,{className:"h-4 w-4"})})});u.displayName=l.PP.displayName;let h=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.wn,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})});h.displayName=l.wn.displayName;let f=r.forwardRef((e,s)=>{let{className:t,children:r,position:i="popper",...n}=e;return(0,a.jsx)(l.ZL,{children:(0,a.jsxs)(l.UC,{ref:s,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...n,children:[(0,a.jsx)(u,{}),(0,a.jsx)(l.LM,{className:(0,c.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(h,{})]})})});f.displayName=l.UC.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.JU,{ref:s,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r})}).displayName=l.JU.displayName;let p=r.forwardRef((e,s)=>{let{className:t,children:r,...i}=e;return(0,a.jsxs)(l.q7,{ref:s,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...i,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(l.VF,{children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})}),(0,a.jsx)(l.p4,{children:r})]})});p.displayName=l.q7.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.wv,{ref:s,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=l.wv.displayName},25488:(e,s,t)=>{"use strict";t.d(s,{E:()=>l});var a=t(95155),r=t(29602);function l(e){let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,r.cn)("animate-pulse rounded-md bg-muted",s),...t})}},63259:(e,s,t)=>{"use strict";t.d(s,{U:()=>r});var a=t(9806);function r(){return(0,a.createClientComponentClient)()}},29602:(e,s,t)=>{"use strict";t.d(s,{cn:()=>l});var a=t(43463),r=t(69795);function l(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,r.QP)((0,a.$)(s))}}},e=>{var s=s=>e(e.s=s);e.O(0,[1181,5593,9806,506,7641,7527,3326,547,2043,5067,8488,8441,1517,7358],()=>s(85791)),_N_E=e.O()}]);